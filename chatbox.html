<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAINTHALCYON Pixel Chatbox</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root {
  --bg-color: #ffd1e5;
  --container-bg: #fff5fb;
  --border-color: #6b6b6b;
  --accent-pink: #ff8fab;
  --text-color: #4a4a4a;
  --chat-bg: #fffdf7;
}

body {
  background: var(--bg-color);
  font-family: 'Press Start 2P', monospace;
  margin: 0;
  font-size: 10px;
  color: var(--text-color);
  display: flex;
  justify-content: center;
  min-height: 100vh;
  padding-top: 20px;
}

#page {
  width: 1000px;
  max-width: 95vw;
  background: var(--container-bg);
  border: 4px solid var(--border-color);
  box-shadow: 8px 8px 0px rgba(0,0,0,0.1);
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

#banner {
  height: 120px;
  border: 3px double var(--border-color);
  background: repeating-linear-gradient(
    45deg,
    #ffbcd9,
    #ffbcd9 10px,
    #ffe3ef 10px,
    #ffe3ef 20px
  );
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ff5c8d;
  font-size: 16px;
}

#main-interface {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

#chat-section {
  flex: 2;
  min-width: 300px;
}

#chat-messages {
  max-height: 400px;
  overflow-y: auto;
  padding: 10px;
  border: 3px double var(--border-color);
  background: var(--chat-bg);
}

.message {
  border-bottom: 1px dotted var(--border-color);
  margin-bottom: 8px;
  padding-bottom: 8px;
}

.message-username {
  color: #ff5c8d;
  font-size: 9px;
}

.message img {
  width: 100px;
  height: 100px;
  image-rendering: pixelated;
  border: 1px solid var(--border-color);
}

.message-time {
  font-size: 7px;
  color: #999;
  text-align: right;
}

#draw-section {
  flex: 1;
  min-width: 250px;
}

#canvas-wrapper {
  width: 220px;
  height: 220px;
  border: 3px double var(--border-color);
  background:
    linear-gradient(45deg, #eee 25%, transparent 25%),
    linear-gradient(-45deg, #eee 25%, transparent 25%),
    linear-gradient(45deg, transparent 75%, #eee 75%),
    linear-gradient(-45deg, transparent 75%, #eee 75%);
  background-size: 20px 20px;
}

#draw-canvas {
  width: 100%;
  height: 100%;
  image-rendering: pixelated;
}

#chat-input-area {
  display: flex;
  gap: 6px;
  padding-top: 10px;
  border-top: 3px solid var(--border-color);
}

input, button {
  font-family: 'Press Start 2P', monospace;
  font-size: 9px;
  padding: 8px;
  border: 2px solid var(--border-color);
}

button {
  background: #ffe3ef;
  cursor: pointer;
}

button.primary {
  background: #ff8fab;
  color: white;
}
</style>
</head>

<body>
<div id="page">
  <div id="banner">SAINTHALCYON</div>

  <div id="main-interface">
    <div id="chat-section">
      <div id="chat-messages"></div>
    </div>

    <div id="draw-section">
      <div id="canvas-wrapper">
        <canvas id="draw-canvas" width="55" height="55"></canvas>
      </div>
    </div>
  </div>

  <div id="chat-input-area">
    <input id="username" placeholder="User" maxlength="12">
    <input id="message" placeholder="Type here..." maxlength="100">
    <button id="send-button" class="primary">SEND</button>
    <button id="send-draw-button">ART</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyB8eG54hE9HNmiEhx7ON7JKWpqc3a4R7ns",
  authDomain: "sainthalcyon-87144.firebaseapp.com",
  databaseURL: "https://sainthalcyon-87144-default-rtdb.firebaseio.com",
  projectId: "sainthalcyon-87144",
  storageBucket: "sainthalcyon-87144.firebasestorage.app",
  messagingSenderId: "257264228367",
  appId: "1:257264228367:web:313ffc00542858c0152b7a"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const messagesRef = ref(db, "messages");

/* CHAT */
const chatMessages = document.getElementById("chat-messages");
const usernameInput = document.getElementById("username");
const messageInput = document.getElementById("message");

function escapeHtml(t) {
  return t.replace(/[&<>"']/g, m =>
    ({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m])
  );
}

document.getElementById("send-button").onclick = () => {
  if (!messageInput.value.trim()) return;
  push(messagesRef, {
    username: usernameInput.value || "Anon",
    message: messageInput.value,
    type: "text",
    timestamp: Date.now()
  });
  messageInput.value = "";
};

document.getElementById("send-draw-button").onclick = () => {
  push(messagesRef, {
    username: usernameInput.value || "Anon",
    message: canvas.toDataURL(),
    type: "art",
    timestamp: Date.now()
  });
};

onChildAdded(messagesRef, snap => {
  const d = snap.val();
  const msg = document.createElement("div");
  msg.className = "message";
  msg.innerHTML = `
    <span class="message-username">${escapeHtml(d.username)}</span>
    ${d.type === "art" ? `<img src="${d.message}">` : escapeHtml(d.message)}
    <div class="message-time">${new Date(d.timestamp).toLocaleTimeString()}</div>
  `;
  chatMessages.appendChild(msg);
  chatMessages.scrollTop = chatMessages.scrollHeight;
});

/* CANVAS */
const canvas = document.getElementById("draw-canvas");
const ctx = canvas.getContext("2d");
ctx.fillStyle = "#fff";
ctx.fillRect(0,0,55,55);

let draw = false;
canvas.onmousedown = () => draw = true;
window.onmouseup = () => draw = false;
canvas.onmousemove = e => {
  if (!draw) return;
  const r = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - r.left) / (r.width / 55));
  const y = Math.floor((e.clientY - r.top) / (r.height / 55));
  ctx.fillStyle = "#ff8fab";
  ctx.fillRect(x, y, 1, 1);
};
</script>
</body>
</html>
